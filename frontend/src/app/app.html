<div class="container-geral">

  <div class="dashboard">
    
    <div class="dash-card">
      <div class="dash-icon">ğŸš€</div>
      <div class="dash-info">
        <span>Progresso</span>
        <div class="progress-bar-bg">
          <div class="progress-bar-fill" [style.width.%]="progress"></div>
        </div>
        <small>{{ progress }}% ConcluÃ­do</small>
      </div>
    </div>

    <div class="dash-card">
      <div class="dash-icon">ğŸ“Š</div>
      <div class="dash-info">
        <span>Total de Tarefas</span>
        <h3>{{ totalTasks }}</h3>
      </div>
    </div>

    <div class="dash-card alert" *ngIf="atrasadas > 0">
      <div class="dash-icon">ğŸ”¥</div>
      <div class="dash-info">
        <span>AtenÃ§Ã£o</span>
        <h3>{{ atrasadas }} Atrasadas</h3>
      </div>
    </div>

  </div>

  <div class="barra-adicionar">
    <input [(ngModel)]="novoTitulo" placeholder="Nova Tarefa..." type="text" (keydown.enter)="adicionar()">
    
    <input [(ngModel)]="novaDescricao" placeholder="Notas (Opcional)" type="text">
    
    <input [(ngModel)]="novoPrazo" type="date" title="Prazo de Entrega">

    <button (click)="adicionar()">+ Adicionar</button>
  </div>

  <div class="kanban-area">
    <div class="kanban-board">

      <div class="coluna todo">
        <h2>
          A Fazer
          <span class="count">{{ todo.length }}</span>
        </h2>

        <div
          cdkDropList
          id="A Fazer"
          [cdkDropListData]="todo"
          [cdkDropListConnectedTo]="['Em Progresso', 'Feito']"
          class="lista"
          (cdkDropListDropped)="drop($event)"
        >
          <div class="card" *ngFor="let item of todo" cdkDrag (click)="abrirDetalhes(item)">
            <button class="btn-delete" (click)="remover(item.id); $event.stopPropagation()">ğŸ—‘ï¸</button>
            
            <div class="card-content">
              <b>{{ item.title }}</b>
              <div class="card-footer">
                <span *ngIf="item.description" title="Tem notas">ğŸ“</span>
                <small *ngIf="item.dueDate" [style.color]="'red'">
                  ğŸ“… {{ item.dueDate | date:'dd/MM' }}
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="coluna doing">
        <h2>
          Em Progresso
          <span class="count">{{ doing.length }}</span>
        </h2>

        <div
          cdkDropList
          id="Em Progresso"
          [cdkDropListData]="doing"
          [cdkDropListConnectedTo]="['A Fazer', 'Feito']"
          class="lista"
          (cdkDropListDropped)="drop($event)"
        >
          <div class="card" *ngFor="let item of doing" cdkDrag (click)="abrirDetalhes(item)">
            <button class="btn-delete" (click)="remover(item.id); $event.stopPropagation()">ğŸ—‘ï¸</button>

            <div class="card-content">
              <b>{{ item.title }}</b>
              <div class="card-footer">
                <span *ngIf="item.description">ğŸ“</span>
                <small *ngIf="item.dueDate">ğŸ“… {{ item.dueDate | date:'dd/MM' }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="coluna done">
        <h2>
          Feito
          <span class="count">{{ done.length }}</span>
        </h2>

        <div
          cdkDropList
          id="Feito"
          [cdkDropListData]="done"
          [cdkDropListConnectedTo]="['A Fazer', 'Em Progresso']"
          class="lista"
          (cdkDropListDropped)="drop($event)"
        >
          <div class="card" *ngFor="let item of done" cdkDrag (click)="abrirDetalhes(item)">
            <button class="btn-delete" (click)="remover(item.id); $event.stopPropagation()">ğŸ—‘ï¸</button>

            <div class="card-content">
              <b style="text-decoration: line-through;">{{ item.title }}</b>
              <div class="card-footer">
                 <span *ngIf="item.description">ğŸ“</span>
                 <small *ngIf="item.dueDate">ğŸ“… {{ item.dueDate | date:'dd/MM' }}</small>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <aside class="details" *ngIf="selecionado">
      <div class="details-header">
        <div class="details-title">Detalhes da Tarefa</div>
        <button class="details-close" (click)="fecharDetalhes()">âœ•</button>
      </div>

      <label class="field">
        <span>TÃ­tulo</span>
        <input [value]="selecionado.title" readonly disabled />
      </label>

      <label class="field">
        <span>Prazo</span>
        <input [value]="selecionado.dueDate | date:'dd/MM/yyyy'" readonly disabled />
      </label>

      <label class="field">
        <span>Notas</span>
        <textarea rows="7" readonly disabled>{{ selecionado.description }}</textarea>
      </label>

      <div class="actions">
        <button class="secondary" (click)="fecharDetalhes()">Fechar</button>
      </div>
    </aside>
  </div>
</div>